<?xml version="1.0" encoding="utf-8"?>
    <robot name="mars_rover" xmlns:xacro="http://ros.org/wiki/xacro">

    <link name = "base_link"/>
    <link name = "base_footprint"/>

    <joint name="base_footprint_joint" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <parent link="base_footprint"/>
      <child link="base_link"/>
    </joint>

      <link
        name="chassis">
        <inertial>
          <origin
            xyz="-0.169915088395825 -0.00199596460135764 -0.00919692919066987"
            rpy="0 0 0" />
          <mass
            value="14.4435926271869" />
          <inertia
            ixx="0.0717912278135852"
            ixy="-7.70091070297908E-07"
            ixz="-6.88067299368864E-07"
            iyy="0.298762417937452"
            iyz="2.41721140540893E-08"
            izz="0.359670360949306" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/base_link.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/base_link.STL" />
          </geometry>
        </collision>
      </link>

      <gazebo reference="chassis">
        <material>Gazebo/Orange</material>
    </gazebo>
    

      <joint name="connector" type="fixed">
        <origin xyz="0 0 0.4" rpy="0 0 0"/>
        <parent link="base_link"/>
        <child link="chassis"/>
      </joint>

      <link name="camera_link">
        <visual>
            <geometry><box size="0.05 0.05 0.05"/></geometry>
            <material name="blue"><color rgba="0 0 1 1"/></material>
        </visual>
        <collision>
            <geometry><box size="0.05 0.05 0.05"/></geometry>
        </collision>
        <inertial>
            <mass value="0.01"/><inertia ixx="1e-4" ixy="0" ixz="0" iyy="1e-4" iyz="0" izz="1e-4"/>
        </inertial>
    </link>

    <joint name="camera_joint" type="fixed">
        <parent link="chassis"/>
        <child link="camera_link"/>
        <origin xyz="0.2 0 0.1" rpy="0 0 0"/>
    </joint>

    <!-- RGBD Camera sensor - handled by realsense2_camera or usb_cam ROS2 package -->
    <!-- <gazebo reference="camera_link">
        <sensor name="rgbd_camera" type="rgbd_camera">
          <always_on>1</always_on>
          <update_rate>250</update_rate>
          <visualize>1</visualize>
          <topic>rgbd_camera</topic>
          <gz_frame_id>camera_link</gz_frame_id>
          
          <camera name="rgbd_camera">
            <horizontal_fov>1.047</horizontal_fov>
            <image>
              <width>640</width>
              <height>480</height>
              <format>R8G8B8</format>
            </image>
            <clip>
              <near>0.1</near>
              <far>100.0</far>
            </clip>
            <noise>
              <type>gaussian</type>
              <mean>0.0</mean>
              <stddev>0.007</stddev>
            </noise>
          </camera>
        </sensor>
      </gazebo> -->

    <link name="camera_link_1">
        <visual>
            <geometry><box size="0.05 0.05 0.05"/></geometry>
            <material name="red"><color rgba="1 0 0 1"/></material>
        </visual>
        <inertial>
            <mass value="0.01"/><inertia ixx="1e-4" ixy="0" ixz="0" iyy="1e-4" iyz="0" izz="1e-4"/>
        </inertial>
    </link>

    <joint name="camera_joint_1" type="fixed">
        <parent link="chassis"/>
        <child link="camera_link_1"/>
        <origin xyz="0.1 0.24 0.1" rpy="0 0 1.57"/>
    </joint>

    <!-- Camera 1 sensor - handled by usb_cam ROS2 package -->
    <!-- <gazebo reference="camera_link_1">
        <sensor name="camera_sensor_1" type="camera">
          <always_on>1</always_on>
          <update_rate>250</update_rate>
          <visualize>1</visualize>
          <topic>camera_1/image_raw</topic>
          
          <camera name="camera_1">
            <horizontal_fov>1.047</horizontal_fov>
            <image>
              <width>640</width>
              <height>480</height>
              <format>R8G8B8</format>
            </image>
            <clip>
              <near>0.1</near>
              <far>100.0</far>
            </clip>
            <noise>
              <type>gaussian</type>
              <mean>0.0</mean>
              <stddev>0.007</stddev>
            </noise>
          </camera>
        </sensor>
      </gazebo> -->

    <link name="camera_link_2">
        <visual>
            <geometry><box size="0.05 0.05 0.05"/></geometry>
            <material name="green"><color rgba="0 1 0 1"/></material>
        </visual>
        <inertial>
            <mass value="0.01"/><inertia ixx="1e-4" ixy="0" ixz="0" iyy="1e-4" iyz="0" izz="1e-4"/>
        </inertial>
    </link>

    <joint name="camera_joint_2" type="fixed">
        <parent link="chassis"/>
        <child link="camera_link_2"/>
        <origin xyz="0.1 -0.24 0.1" rpy="0 0 -1.57"/>
    </joint>

    <!-- Camera 2 sensor - handled by usb_cam ROS2 package -->
    <!-- <gazebo reference="camera_link_2">
        <sensor name="camera_sensor_2" type="camera">
          <always_on>1</always_on>
          <update_rate>250</update_rate>
          <visualize>1</visualize>
          <topic>camera_2/image_raw</topic>
          
          <camera name="camera_2">
            <horizontal_fov>1.047</horizontal_fov>
            <image>
              <width>640</width>
              <height>480</height>
              <format>R8G8B8</format>
            </image>
            <clip>
              <near>0.1</near>
              <far>100.0</far>
            </clip>
            <noise>
              <type>gaussian</type>
              <mean>0.0</mean>
              <stddev>0.007</stddev>
            </noise>
          </camera>
        </sensor>
      </gazebo> -->

    <link name="imu_link">
        <visual>
            <geometry><box size="0.02 0.02 0.01"/></geometry>
            <material name="yellow"><color rgba="1 1 0 1"/></material>
        </visual>
        <inertial>
            <mass value="0.001"/><inertia ixx="1e-5" ixy="0" ixz="0" iyy="1e-5" iyz="0" izz="1e-5"/>
        </inertial>
    </link>

    <joint name="imu_joint" type="fixed">
        <origin xyz="0 0 0" rpy="0 0 0" />
        <parent link="chassis"/>
        <child link="imu_link"/>
    </joint>

    <!-- IMU sensor - handled by appropriate IMU ROS2 driver package -->
    <!-- <gazebo reference="imu_link">
      <sensor name="imu_sensor" type="imu">
      <always_on>1</always_on>
      <update_rate>250</update_rate>
      <visualize>true</visualize>
      <topic>imu</topic>
      <gz_frame_id>imu_link</gz_frame_id>
      </sensor>
    </gazebo> -->


    <link name="gps_link"/>
    <joint name="gps_joint" type="fixed">
        <parent link="base_link"/>
        <child link="gps_link"/>
        <origin xyz="0 0 0.5" rpy="0 0 0"/>
    </joint>

    <!-- GPS sensor - handled by nmea_navsat_driver ROS2 package -->
    <!-- <gazebo reference="gps_link">
      <sensor name="gps_link" type="navsat">
        <always_on>1</always_on>
        <update_rate>250</update_rate>
        <topic>gps/fix</topic>
        <gz_frame_id>gps_link</gz_frame_id>
      </sensor>
    </gazebo> -->

    <link name="lidar_link">
      <inertial>
        <mass value="0.1"/>
        <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
      </inertial>
      <visual>
        <geometry>
          <cylinder radius="0.05" length="0.04"/>
        </geometry>
        <material name="black"><color rgba="0 0 0 1"/></material>
      </visual>
      <collision>
        <geometry>
          <cylinder radius="0.05" length="0.04"/>
        </geometry>
      </collision>
    </link>

    <joint name="lidar_joint" type="fixed">
      <parent link="chassis"/>
      <child link="lidar_link"/>
      <origin xyz="0 0 0.2" rpy="0 0 0"/>
    </joint>

    <!-- LiDAR sensor - handled by rplidar_ros or ydlidar_ros2_driver ROS2 package -->
    <!-- <gazebo reference="lidar_link">
      <sensor name="gpu_lidar" type="gpu_lidar">
        <pose>0 0 0 0 0 0</pose>
        <topic>scan</topic>
        <update_rate>20</update_rate>
        <gz_frame_id>lidar_link</gz_frame_id>
        <lidar>
          <scan>
            <horizontal>
              <samples>640</samples>
              <resolution>1</resolution>
              <min_angle>-3.14159</min_angle>
              <max_angle>3.14159</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.1</min>
            <max>10.0</max>
            <resolution>0.01</resolution>
          </range>
        </lidar>
        <visualize>true</visualize>
      </sensor>
    </gazebo> -->

      <link
        name="steering1">
        <inertial>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <mass
            value="0.5" />
          <inertia
            ixx="0.0018"
            ixy="0.0"
            ixz="0.0"
            iyy="0.0015"
            iyz="0.0"
            izz="0.0017" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering1.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering1.STL" />
          </geometry>
        </collision>
      </link>

      <gazebo reference="steering1">
        <material>Gazebo/Grey</material>
    </gazebo>
   <!-- just change the joint type from fixed to revolute for all the steer joints when we would change the controller-->
      <joint
        name="steer1"
        type="fixed"> 
        <origin
          xyz="-0.52941 0.29162 -0.12851"
          rpy="0 -1.8353E-05 0" />
        <parent
          link="chassis" />
        <child
          link="steering1" />
        <axis
          xyz="0 0 1" />
      </joint>
      <link
        name="wheel1">
        <inertial>
          <origin
            xyz="-0.000142261151015677 0.000391028851553232 -0.067999985619256"
            rpy="0 0 0" />
          <mass
            value="1.96171696755186" />
          <inertia
            ixx="0.0111765177053231"
            ixy="3.63484716438248E-14"
            ixz="-9.83139513884305E-10"
            iyy="0.0111765177116241"
            iyz="-1.70424653629502E-07"
            izz="0.0157859329323531" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/wheel1.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
				        <cylinder radius="0.11" length="0.144"/>
			   </geometry>
        </collision>
      </link>

      <gazebo reference="wheel1">
        <material>Gazebo/DarkGrey</material>
        <mu1>1.0</mu1>
        <mu2>0.2</mu2>
        <fdir1>1 0 0</fdir1>
        <minDepth>0.001</minDepth>
        <kp>100000000.0</kp>
        <kd>1.0</kd>
    </gazebo>

      <joint
        name="front_left_wheel_joint"
        type="continuous">
        <origin
          xyz="0.000353156675627797 0.0676257237290513 -0.216586122585117"
          rpy="-1.5708332999603 1.83526331234849E-05 0.00321478961806723" />
        <parent
          link="steering1" />
        <child
          link="wheel1" />
        <axis
          xyz="0 0 1" />
        <limit effort="1000.0" velocity="20.0"/>
      </joint>
      <link
        name="steering2">
        <inertial>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <mass
            value="0.5" />
          <inertia
            ixx="0.0018"
            ixy="0.0"
            ixz="0.0"
            iyy="0.0015"
            iyz="0.0"
            izz="0.0017" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering2.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering2.STL" />
          </geometry>
        </collision>
      </link>

      <gazebo reference="steering2">
        <material>Gazebo/Grey</material>
    </gazebo>

      <joint
        name="steer2"
        type="fixed">
        <origin
          xyz="-0.52941 -0.29588 -0.1285"
          rpy="0 0 0" />
        <parent
          link="chassis" />
        <child
          link="steering2" />
        <axis
          xyz="0 0 1" />
      </joint>
      <link
        name="wheel2">
        <inertial>
          <origin
            xyz="-0.000413021540613123 -2.44790194104949E-05 0.0679999999991169"
            rpy="0 0 0" />
          <mass
            value="1.96171696755186" />
          <inertia
            ixx="0.0111765177053229"
            ixy="1.46936453891669E-17"
            ixz="-1.59919820441612E-18"
            iyy="0.0111765177053229"
            iyz="-1.6690363377749E-17"
            izz="0.0157859329386544" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/wheel2.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
				        <cylinder radius="0.11" length="0.144"/>
			   </geometry>
        </collision>
      </link>

      <gazebo reference="wheel2">
        <material>Gazebo/DarkGrey</material>
        <mu1>1.0</mu1>
        <mu2>0.2</mu2>
        <fdir1>1 0 0</fdir1>
        <minDepth>0.001</minDepth>
        <kp>100000000.0</kp>
        <kd>1.0</kd>
    </gazebo>

      <joint
        name="rear_left_wheel_joint"
        type="continuous">
        <origin
          xyz="0.00260503655999339 -0.0673405250297557 -0.216999105202697"
          rpy="-1.5707963267949 0 0.0261401718711602" />
        <parent
          link="steering2" />
        <child
          link="wheel2" />
        <axis
          xyz="0 0 1" />
        <limit effort="1000.0" velocity="20.0"/>
      </joint>
      <link
        name="steering3">
        <inertial>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <mass
            value="0.5" />
          <inertia
            ixx="0.0018"
            ixy="0.0"
            ixz="0.0"
            iyy="0.0015"
            iyz="0.0"
            izz="0.0017" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering3.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering3.STL" />
          </geometry>
        </collision>
      </link>

      <gazebo reference="steering3">
        <material>Gazebo/Grey</material>
    </gazebo>

      <joint
        name="steer_3"
        type="fixed">
        <origin
          xyz="0.32344 -0.29562 -0.1285"
          rpy="0 0 0" />
        <parent
          link="chassis" />
        <child
          link="steering3" />
        <axis
          xyz="0 0 1" />
      </joint>
      <link
        name="wheel3">
        <inertial>
          <origin
            xyz="0.00012752326976001 0.000393603647906415 0.0679999999986239"
            rpy="0 0 0" />
          <mass
            value="1.96171696755186" />
          <inertia
            ixx="0.0111765177053229"
            ixy="1.46784681409658E-17"
            ixz="-1.1367644329826E-15"
            iyy="0.0111765177053229"
            iyz="-3.63032951516692E-17"
            izz="0.0157859329386544" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/wheel3.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
				        <cylinder radius="0.11" length="0.144"/>
			   </geometry>
        </collision>
      </link>

      <gazebo reference="wheel3">
        <material>Gazebo/DarkGrey</material>
        <mu1>1.0</mu1>
        <mu2>0.2</mu2>
        <fdir1>1 0 0</fdir1>
        <minDepth>0.001</minDepth>
        <kp>100000000.0</kp>
        <kd>1.0</kd>
    </gazebo>

      <joint
        name="rear_right_wheel_joint"
        type="continuous">
        <origin
          xyz="-0.000555418729084156 -0.067625619393596 -0.216581022537134"
          rpy="-1.5707963267949 0 0" />
        <parent
          link="steering3" />
        <child
          link="wheel3" />
        <axis
          xyz="0 0 1" />
        <limit effort="1000.0" velocity="20.0"/>
      </joint>
      <link
        name="steering4">
        <inertial>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <mass
            value="0.5" />
          <inertia
            ixx="0.0018"
            ixy="0.0"
            ixz="0.0"
            iyy="0.0015"
            iyz="0.0"
            izz="0.0017" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering4.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            <mesh
              filename="package://rover_description/meshes/steering4.STL" />
          </geometry>
        </collision>
      </link>

      <gazebo reference="steering4">
        <material>Gazebo/Grey</material>
      </gazebo>

      <joint
        name="steer4"
        type="fixed">
        <origin
          xyz="0.32345 0.29186 -0.12849"
          rpy="0 -1.8353E-05 0" />
        <parent
          link="chassis" />
        <child
          link="steering4" />
        <axis
          xyz="0 0 1" />
      </joint>
      <link
        name="wheel4">
        <inertial>
          <origin
            xyz="0.000413714800629517 -5.10683655707833E-06 -0.0679999999999992"
            rpy="0 0 0" />
          <mass
            value="1.96171696755186" />
          <inertia
            ixx="0.0111765177053229"
            ixy="7.33822171003051E-18"
            ixz="-1.84314369322536E-18"
            iyy="0.011176517705323"
            iyz="-2.23015354728552E-17"
            izz="0.0157859329386545" />
        </inertial>
        <visual>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
            
            <mesh
              filename="package://rover_description/meshes/wheel4.STL" />
          </geometry>
          <material
            name="">
            <color
              rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
          </material>
        </visual>
        <collision>
          <origin
            xyz="0 0 0"
            rpy="0 0 0" />
          <geometry>
				        <cylinder radius="0.11" length="0.144"/>
			   </geometry>
        </collision>
      </link>

      <gazebo reference="wheel4">
        <material>Gazebo/DarkGrey</material>
        <mu1>1.0</mu1>
        <mu2>0.2</mu2>
        <fdir1>1 0 0</fdir1>
        <minDepth>0.001</minDepth>
        <kp>100000000.0</kp>
        <kd>1.0</kd>
    </gazebo>

      <joint
        name="front_right_wheel_joint"
        type="continuous">
        <origin
          xyz="-0.00146559562126541 0.0673855594536285 -0.21697972522299"
          rpy="-1.5707963246485 1.83519361346148E-05 0.00917303616199558" />
        <parent
          link="steering4" />
        <child
          link="wheel4" />
        <axis
          xyz="0 0 1" />
        <limit effort="1000.0" velocity="20.0"/>
      </joint>

    <ros2_control name="RoverSystem" type="system">
      <hardware>
        <plugin>rover_hardware/RoverCANInterface</plugin>
        <param name="uart_port">/dev/ttyTHS1</param>  <!-- Jetson UART port -->
        <param name="uart_baudrate">115200</param>
      </hardware>
      <joint name="front_left_wheel_joint">
        <command_interface name="velocity">
          <param name="min">-26.18</param>  <!-- rad/s -->
          <param name="max">26.18</param>
        </command_interface>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>

      <joint name="rear_left_wheel_joint">
        <command_interface name="velocity">
          <param name="min">-26.18</param>
          <param name="max">26.18</param>
        </command_interface>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>

      <joint name="front_right_wheel_joint">
        <command_interface name="velocity">
          <param name="min">-26.18</param>
          <param name="max">26.18</param>
        </command_interface>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>

      <joint name="rear_right_wheel_joint">
        <command_interface name="velocity">
          <param name="min">-26.18</param>
          <param name="max">26.18</param>
        </command_interface>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>
    </ros2_control>

</robot>
